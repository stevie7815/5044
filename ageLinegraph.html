<!DOCTYPE html>
<html>

<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <title>CS5044: Practical 2 </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="style.css" />
</head>


<body>
    <header>
        <h1>Which Social Movements & Protests had the largest impact on police shootings?</h1>
        <hr>
    </header>
    <main class="wrapper">
        <div>
            <a class="dataset" href="data/dataset-linegraphAge.csv" target="_blank">Data Set</a>
        </div>
        <br><br>

        <div class="categories_section">
            <div class="category_cards">
                <a href="byRace.html">
                    <b>Police Shootings by Race</b>
                </a>
            </div>
            <div class="category_cards">
                <a href="age.html">
                    <b>Age Groups and Mental Health</b>
                </a>
            </div>
            <div class="category_cards">
                <a href="year.html">
                    <b>Police Shootings and Mental Illness</b>
                </a>
            </div>
            <div class="category_cards_active">
                <a href="ageLinegraph.html">
                    <b>Police Shootings and Age by Year</b>
                </a>
            </div>
        </div>
        <br><br>

        </div>
        <h1>Police Shootings by Mental Illness and Year</h1>


        <svg id="lineGraph" width="900" height="400"></svg>

    </main>

    <!--
<footer>
    <p>Created by: sd302 & ifz1</p>
</footer>
-->

<script>

    // This is the start of the linegraph
    
    
    // Load the data
    d3.csv("data/dataset-linegraphAge.csv", function(d) {
        d.age = +d.age;
        d.mentalIllness = +d.mentalIllness;
        d.killed = +d.killed;
        return d;
    }).then(function(data) {
    
    const width = 900;
    const height = 400;
    const margin = { top: 20, right: 300, bottom: 35, left: 50 };
        
    // Set the dimensions of the chart
    const innerWidth = width - margin.left - margin.right;
    const innerHeight = height - margin.top - margin.bottom;
    
    
    // Create the SVG element
    const svg = d3.select("#lineGraph").append("svg")
        .attr("width", width)
        .attr("height", height);
    
    const rolledData = d3.rollup(data, (v) => d3.sum(v, (d) => d.killed),d => d.signs_of_mental_illness, (d) => d.age);

    console.log(rolledData);

    const countExtent = [0, d3.max(d3.hierarchy(rolledData).leaves().map(d => d.data[1]))];

    
    // Define the scales
    const ageExtent = d3.extent(data, (d) => d.age);
    //console.log(ageExtent);
    const xScale = d3.scaleLinear()
        .range([0, innerWidth])
        .domain(ageExtent)
    
        
    const yScale = d3.scaleLinear()
        .domain(countExtent)
        .range([innerHeight, 0]);
    
    // Define the axes
    const xAxis = d3.axisBottom(xScale)
    
    const yAxis = d3.axisLeft(yScale);
    
    // Add the axes
        svg.append("g")
            .attr("transform", `translate(${margin.left}, ${innerHeight + margin.top})`)
            .call(xAxis);
    
        svg.append("g")
            .attr("transform", `translate(${margin.left}, ${margin.top})`)
            .call(yAxis);
    
        // Add x-axis label
        svg.append("text")           
            .attr("transform", `translate(${width/3},${height - margin.top + 20})`)
            .style("text-anchor", "middle")
            .text("Age");
    
    // Add y-axis label
        svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 0)
            .attr("x",0 - (height / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .text("Number of Police Shootings");
    
    let noMentalIllness = rolledData.get("FALSE");
    let mentalIllness = rolledData.get("TRUE");
    
    //Define the line functions
    const line1 = d3.line()
        .x((d) => xScale(d[0])) // Use the year as the x-value
        .y((d) => yScale(d[1])) // Use the sum as the y-value
    
    const line2 = d3.line()
        .x((d) => xScale(d[0]))
        .y((d) => yScale(d[1]))
    
    // Add the line for shootings with mental illness signs
    svg.append("path")
        .datum(mentalIllness)
        .attr("fill", "none")
        .attr("stroke", "steelblue")
        .attr("stroke-width", 2)
        .attr("d", line1) // Use the "d" attribute to specify the line function
        .attr("transform", `translate(${margin.left}, ${margin.top})`);
    
    // Add the line for shootings without mental illness signs
    svg.append("path")
        .datum(noMentalIllness)
        .attr("fill", "none")
        .attr("stroke", "orange")
        .attr("stroke-width", 2)
        .attr("d", line2)
        .attr("transform", `translate(${margin.left}, ${margin.top})`);
    
    // Legend code adapted from https://d3-graph-gallery.com/graph/custom_legend.html
    svg.append("circle")
        .attr("cx",550)
        .attr("cy",70)
        .attr("r", 7)
        .style("fill", "orange")
    
    svg.append("circle")
        .attr("cx",550)
        .attr("cy",100)
        .attr("r", 7)
        .style("fill", "steelblue")
    
    svg.append("text")
        .attr("x", 570)
        .attr("y", 100)
        .text("Shootings with mental illness signs")
        .style("font-size", "15px")
        .attr("alignment-baseline","middle")
    
    svg.append("text")
        .attr("x", 570)
        .attr("y", 70)
        .text("Shootings without mental illness signs")
        .style("font-size", "15px")
        .attr("alignment-baseline","middle")

    
    });
        
        //This is the end of the linegraph
        
        </script>