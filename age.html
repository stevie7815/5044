<!DOCTYPE html>
<html>

<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <title>CS5044: Practical 2 </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="style.css" />

    <script src="https://unpkg.com/topojson@3"></script>

</head>

<body>
    <header>
        <h1>Which Social Movements & Protests had the largest impact on police shootings?</h1>
        <hr>
    </header>
    <main class="wrapper">
        <div>
            <a class="dataset" href="data/dataset.csv" target="_blank">Data Set</a>
        </div>
        <br><br>

        <div class="categories_section">
            <div class="category_cards">
                <a href="byRace.html">
                    <b>Police Shootings by Race</b>
                </a>
            </div>
            <div class="category_cards_active">
                <a href="age.html">
                    <b>Age Groups and Mental Health</b>
                </a>
            </div>
            <div class="category_cards">
                <b>John Doe</b>
            </div>
            <div class="category_cards">
                <b>John Doe</b>
            </div>
        </div>
        <br><br>
        </div>
        <h1>Age Groups and Mental Health</h1>

        <svg width="600" height="400"></svg>

    </main>
    <footer>
        <p>Created by: sd302 & ifz1</p>
    </footer>

    <script>


        // set dimensions and margins
        var margin = {
            top: 20,
            right: 20,
            bottom: 30,
            left: 40
        };
        var width = 600 - margin.left - margin.right;
        var height = 400 - margin.top - margin.bottom;

        // create svg for map
        var svg = d3.select("svg")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);

        // set up x and y scale
        const xScale = d3.scaleBand()
            .range([0, width])
            .padding(0.1);

        const yScale = d3.scaleLinear()
            .range([height, 0]);

        // x y axis add to svg
        /* const xAxis = svg.append("g")
             .attr("class", "axis-x")
             .attr("transform", "translate(${margin.left}, ${height + margin.top})");
 
         const yAxis = svg.append("g")
             .attr("class", "axis-y")
             .attr("transform", "translate(${margin.left}, ${margin.top})");
 */
        const xAxis = d3.axisBottom(xScale);
        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);

        const yAxis = d3.axisLeft(yScale);
        svg.append("g")
            .call(yAxis);

        // create svg 
        svg.append("text")
            .attr("class", "title")
            .attr("x", width / 2 + margin.left)
            .attr("y", margin.top / 2)
            .text("Age Groups and Mental Health");

        d3.csv("data/dataset.csv").then(function (data) {
            // group data by age group and mental health
            const groupedData = d3.group(data, d => d.age, d => d.signs_of_mental_illness);

            // calculate number of incidents
            const nestedData = Array.from(groupedData, ([age, values]) => {
                const total = d3.sum(values, d => d.value);
                return { age: age, mh: values[0].signs_of_mental_illness, value: total };
            });

            // x y scales
            xScale.domain(nestedData.map(d => d.age));
            yScale.domain([0, d3.max(nestedData, d => d.value)]);

            // updata x y axis
            xAxis.call(d3.axisBottom(xScale));
            yAxis.call(d3.axisLeft(yScale));

            // add bars
            svg.selectAll(".bar")
                .data(nestedData)
                .join("rect")
                .attr("class", "bar")
                .attr("x", d => xScale(d.age) + margin.left)
                .attr("y", d => yScale(d.value) + margin.top)
                .attr("width", xScale.bandwidth())
                .attr("height", d => height - yScale(d.value)) // height relative to the bottom
                .attr("fill", d => colour(d.age)) // add colour to bars
                .append("title")
                .text(d => `${d.age}, ${d.signs_of_mental_illness}: ${d.value}`)

        }).catch(function (error) {
            console.log(error);
        });

    </script>
</body>

</html>