<!DOCTYPE html>
<html>

<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <title>CS5044: Practical 2 </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="style.css" />

</head>

<body>
    <header>
        <h1>Which Social Movements & Protests had the largest impact on police shootings?</h1>
        <hr>
    </header>
    <main class="wrapper">
        <div>
            <a class="dataset" href="dataset.csv" target="_blank">Data Set</a>
        </div>
        <p>main</p>
        <p></p>
        <div id="lineGraph"></div>

    </main>
    <footer>
        <p>Created by: sd302 & ifz1</p>
    </footer>
</body>

</html>

<script>

    //this is the linegraph

    (async () => {

const dataPath = "dataset.csv";

const width = 600; 
const height = 300; 
const margin = 50; 

const data = await d3.csv(dataPath);

d3.csv(dataPath)
    .then((data) => {
        //console.log(data);
        //console.table(data)

    //const nestedData = d3.group(data, d => d.signs_of_mental_illness, d => d.date);
    //console.log(nestedData);

    const rolledData = d3.rollup(data, v => d3.sum(v, d => d.Killed), d => d.signs_of_mental_illness, d => d.date);
    //console.log(rolledData);

    const timeExtent = d3.extent(data, (d) => d.date);

    //console.log(timeExtent);

    
    const xScale = d3.scaleTime()
            .domain(timeExtent)
            .range([0, width]);

    //Below code needs to be changed to get the max value of the data on Y-axis
    const countKilled = d3.extent(d3.hierarchy(rolledData).leaves().map(d => d.data[1]));
    //console.log(countKilled);

   const yScale = d3.scaleLinear()
                .domain(countKilled)
                .range([height, 0]);
    
    const x_axis = d3.axisBottom(xScale);
    const y_axis = d3.axisLeft(yScale);

    const svg = d3.select("#lineGraph")
        .append("svg")
        .attr("width", width + margin)
        .attr("height", height + margin);

    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", `translate(${margin},${height})`)
        .call(x_axis.tickFormat(d3.timeFormat("%Y-%m-%d")))
        .selectAll("text")
        .style("text-anchor", "end")
        .attr("dx", "-0.8em")
        .attr("dy", "0.15em")
        .attr("transform", "rotate(-65)");

    svg.append("g")
        .attr("class", "y axis")
        .attr("transform", `translate(${margin},0)`)
        .call(y_axis);

    const lineGenerator = d3.line()
        .x((d) => margin + xScale(d[0]))
        .y((d) => yScale(d[1]));

    let noMentalIllness = rolledData.get("FALSE");
    console.log(noMentalIllness);
    let mentalIllness = rolledData.get("TRUE");
    console.log(mentalIllness);

    
    svg.append("path")
            .datum(noMentalIllness)
            .attr("class", "line")
            .attr("d", lineGenerator);

    svg.append("path")
            .datum(mentalIllness)
            .attr("class", "line")
            .attr("d", lineGenerator);            
    })

})();

    // end of line graph

</script>
