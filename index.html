<!DOCTYPE html>
<html>

<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <title>CS5044: Practical 2 </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <header>
        <h1>Which Social Movements & Protests had the largest impact on police shootings?</h1>
        <hr>
    </header>
    <main class="wrapper">
        <div>
            <a class="dataset" href="data/dataset.csv" target="_blank">Data Set</a>
        </div><br>
        <p>main</p>
        <h1>Police Shootings: Mental Health and Timeline</h1>

    </main>
    <footer>
        <p>Created by: sd302 & ifz1</p>
    </footer>

    <script>

        let dataPath = "data/dataset.csv";
        
                d3.csv(dataPath)
                    .then((data) => {
                        console.log(data);
        
                        let myData = data;
        
                        let margin = 50;	//margins the left
                        let width = 700; 	//width of the svg element (in pixels)
                        let height = 350;	//height of the svg element
        
                        //find min/max values from LifeSatisfaction attribute
                        let extent_date = d3.extent(myData, (d) => parseFloat(d.date));
                        // shortcut for line above
                        //let extent_lifeSatisfaction = d3.extent(myData, function(d){return parseFloat(d.LifeSatisfaction)});
                        let extent_signs_of_mental_illness = d3.extent(myData, (d) => parseFloat(d.signs_of_mental_illness));
        
                        console.log(extent_date);
        
                        //calculate the scaling function - 'domain' is data, 'range' is output, both arrays with 2 values
                        let x_scale = d3.scaleLinear()
                            .range([margin, width - margin])		// we can scale according to a new array with 2 values
                            .domain([0, extent_date[1]]);	// extent_date already has 2 values
        
                        // CALCULATE CIRCLE Y POSITIOn FROM LONGHOURS
                        let y_scale = d3.scaleLinear()
                            .range([height - margin, margin])		// -,- top left corner, so lowest value = largest height
                            .domain([0, extent_signs_of_mental_illness[1]]);
        
                        // DEFINING X- AND Y-AXES (DEFINE X_SCALE AND Y_SCALE FIRST)
                        let x_axis = d3.axisBottom(x_scale);
                        let y_axis = d3.axisLeft(y_scale);
        
                        // CREATE NEW SVG USING D3.SELECT
                        let scatterplot_SVG = d3.select("body")		//select the "body" of the html document
                            .append("svg")
                            .attr("width", width)
                            .attr("height", height);
        
                        // create a circle per data
                        scatterplot_SVG.selectAll("circle")
                            .data(myData)
                            .enter()
                            .append("circle")
                            .attr("cx", (d) => x_scale(parseFloat(d.date)))		// cx: circle x-position (centre)
                            .attr("cy", (d) => y_scale(parseFloat(d.signs_of_mental_illness)))			// cy: circle y-position (centre)
                            .attr("r", 5)												// r: circle radius
                            // ADD INTERACTION - when hover over dots
                            .on("mouseover", (e, d) =>{		//remember events return the event before the data point!
                                console.log(d.Country);
                                d3.select("svg")
                                    .append("text")
                                    .attr("class", "tooltip")	// for selection later
                                    .text(d.Country)
                                    .attr("x", x_scale(parseFloat(d.date)) + 10)
                                    .attr("y", y_scale(parseFloat(d.signs_of_mental_illness)) + 10);
                            })
                            .on("mouseout", (e, d) =>{
                                d3.selectAll(".tooltip")	// remember . for class selector - # for id
                                    .remove();
                            })
                        // ADDING THE X AXIS TO THE SVG ELEMENT
                        d3.select("svg")		// select the svg element
                                .append("g")	// axes contain several elements. "g" is a new group to contain them
                                    .attr("class", "x axis")		// assign class for styling
                                    .attr("transform", `translate(0, ${height-margin})`) // string template literal - another useful JS concept!
                                    .call(x_axis);
        
                        // ADDING THE Y-AXIS USING D3.AXISLEFT
                        d3.select("svg")
                                .append("g")
                                    .attr("class", "y axis")
                                    .attr("transform", `translate(${margin},0)`)
                                    .call(y_axis);
        
                        // ADDING AXIS TITLES
                        d3.select(".x.axis")	// CSS selector finds elements with BOTH x and y axis classes
                                .append("text")
                                    .text("Life satisfaction (0-10)")
                                    .style("fill", "black")
                                    .attr("x", (width-margin)/2)
                                    .attr("y", margin);
                        
                        d3.select(".y.axis")
                                .append("text")
                                    .text("% of employees working over 50 hours")
                                    .style("fill", "black")
                                    .attr("transform", `rotate(-90,0,${margin-10}) translate(${-margin},0)`);
                    });
        </script>
</body>
</html>
